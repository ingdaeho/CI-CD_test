name: CI

on:
  push:
    tags:
      - admin-web

  workflow_dispatch:

jobs:
  job_install_dependencies:
  name: Install Dependencies
  runs-on: ubuntu-latest
  timeout-minutes: 15
  steps:
    - name: Check out current commit (${{ github.sha }})
      uses: actions/checkout@v2

    - name: Set up Node
      uses: actions/setup-node@v1

    - name: Compute dependency cache key
      id: compute_lockfile_hash
      run: echo "::set-output name=hash::${{ hashFiles('package-lock.json') }}"

    - name: Check dependency cache
      uses: actions/cache@v2
      id: cache_dependencies
      with:
        path: node
        key: ${{ steps.compute_lockfile_hash.outputs.hash }}

    - name: Install dependencies
      if: steps.cache_dependencies.outputs.cache-hit == ''
      run: yarn
  outputs:
    dependency_cache_key: ${{ steps.compute_lockfile_hash.outputs.hash }}

  job_build:
    name: build
    needs: job_install_dependencies
    runs-on: ubuntu-latest
    steps:
      - name: build admin-web
        run: yarn build
